<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fuzzy Link Search</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#6ee7b7; --glass: rgba(255,255,255,0.03);
      --radius:16px; --gap:18px; --maxw:980px;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; background:linear-gradient(180deg,#071226 0%, #071726 60%); color:#e6eef6}
    .wrap{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px}
    .card{width:100%; max-width:var(--maxw); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:20px; padding:28px; box-shadow:0 10px 30px rgba(2,6,23,0.6); backdrop-filter: blur(6px)}

    .top{display:flex; gap:18px; align-items:center; flex-wrap:wrap}
    .title{flex:1}
    .title h1{margin:0;font-size:20px;font-weight:600}
    .title p{margin:4px 0 0;color:var(--muted);font-size:13px}

    .searchBox{width:100%; margin-top:18px}
    .inputLarge{width:100%; padding:22px 20px; border-radius:14px; font-size:18px; outline:none; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:inherit; box-shadow: inset 0 -6px 18px rgba(2,6,23,0.5)}
    .meta{display:flex; gap:12px; margin-top:10px; align-items:center}
    .hint{color:var(--muted); font-size:13px}

    .list{margin-top:22px; display:grid; gap:12px}
    .item{display:flex; flex-direction:column; padding:12px 14px; border-radius:12px; background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.007)); border:1px solid rgba(255,255,255,0.02); transition:transform .12s ease, box-shadow .12s ease; cursor:pointer}
    .item:focus{outline:none; box-shadow:0 8px 24px rgba(0,0,0,0.6); transform:translateY(-3px)}
    .item:hover{transform:translateY(-4px)}
    .item .row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .item .titleName{font-weight:600}
    .item .url{font-size:13px; color:var(--muted); margin-top:6px}
    .score{font-size:12px; color:var(--muted); margin-left:10px}

    .empty{padding:24px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); color:var(--muted)}

    @media (max-width:640px){.card{padding:18px;border-radius:14px}.inputLarge{padding:16px;font-size:16px}.title h1{font-size:16px}}
  </style>
</head>
<body>
  <div class="wrap">
    <main class="card" role="application">
      <div class="top">
        <div class="title">
          <h1>Rychlé hledání odkazů (fuzzy)</h1>
          <p>Napiš název nebo část URL. Podporuje překlepy a relevanci.</p>
        </div>
      </div>

      <div class="searchBox">
        <input id="search" class="inputLarge" placeholder="Hledat... (Enter = otevřít první)" autofocus autocomplete="off" />
        <div class="meta">
          <div class="hint">Tab přepíná mezi odkazy · Šipky ↑/↓ vyberou položku · Enter otevře vybranou / první</div>
        </div>
      </div>

      <div id="results" class="list" aria-live="polite"></div>

    </main>
  </div>

  <script>
    // --- configurable list (title + url) ---
    const LINKS = [
      {title: 'Google', url: 'https://www.google.com'},
      {title: 'GitHub', url: 'https://github.com'},
      {title: 'Stack Overflow', url: 'https://stackoverflow.com'},
      {title: 'MDN Web Docs', url: 'https://developer.mozilla.org'},
      {title: 'YouTube', url: 'https://www.youtube.com'},
      {title: 'Wikipedia', url: 'https://www.wikipedia.org'},
      {title: 'České noviny', url: 'https://www.novinky.cz'},
      {title: 'Hacker News', url: 'https://news.ycombinator.com'},
      {title: 'Reddit', url: 'https://www.reddit.com'},
      {title: 'Vimeo', url: 'https://vimeo.com'}
    ];

    // --- helpers: Levenshtein distance for fuzzy scoring ---
    function levenshtein(a, b) {
      if (!a || !b) return (a||b) ? Math.max(a.length,b.length) : 0;
      const m = a.length, n = b.length;
      const dp = Array(m+1).fill(null).map(()=>Array(n+1).fill(0));
      for(let i=0;i<=m;i++) dp[i][0]=i;
      for(let j=0;j<=n;j++) dp[0][j]=j;
      for(let i=1;i<=m;i++){
        for(let j=1;j<=n;j++){
          const cost = a[i-1] === b[j-1] ? 0 : 1;
          dp[i][j] = Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost);
        }
      }
      return dp[m][n];
    }

    function scoreMatch(query, target) {
      query = query.trim().toLowerCase();
      target = target.toLowerCase();
      if (!query) return 0.01; // tiny baseline
      // exact substring is best
      if (target.includes(query)) return 1 + (query.length / Math.max(target.length,1));
      // compute normalized similarity
      const dist = levenshtein(query, target);
      const maxLen = Math.max(query.length, target.length);
      const sim = 1 - (dist / maxLen); // can be negative
      return Math.max(0, sim);
    }

    // Combined score (title and url)
    function computeScore(q, item){
      const tScore = scoreMatch(q, item.title);
      const uScore = scoreMatch(q, item.url);
      // weight title higher
      const combined = (tScore * 1.1) + (uScore * 0.9);
      return combined;
    }

    // --- UI rendering & keyboard logic ---
    const input = document.getElementById('search');
    const resultsEl = document.getElementById('results');
    let filtered = LINKS.slice();
    let selectedIndex = -1;

    function renderList(items){
      resultsEl.innerHTML = '';
      if (!items.length) {
        const e = document.createElement('div'); e.className='empty'; e.textContent='Žádné výsledky.'; resultsEl.appendChild(e); return;
      }
      items.forEach((it, idx)=>{
        const el = document.createElement('div');
        el.className = 'item';
        el.setAttribute('tabindex','0'); // makes it reachable by Tab
        el.setAttribute('role','link');
        el.dataset.index = idx;
        el.innerHTML = `
          <div class="row">
            <div class="titleName">${escapeHtml(it.title)}</div>
            <div class="score">${(it._score||0).toFixed(2)}</div>
          </div>
          <div class="url">${escapeHtml(it.url)}</div>
        `;
        // mouse / click
        el.addEventListener('click', ()=>{ openUrl(it.url); });
        // keyboard on item
        el.addEventListener('keydown', (ev)=>{
          if(ev.key === 'Enter') openUrl(it.url);
          else if (ev.key === 'ArrowDown') focusIndex(idx+1);
          else if (ev.key === 'ArrowUp') focusIndex(idx-1);
          else if (ev.key === 'Tab') {
            // allow native tabbing from items (cycle)
            ev.preventDefault();
            if (ev.shiftKey) {
              // go back to input
              input.focus();
            } else {
              focusIndex(idx+1);
            }
          }
        });
        el.addEventListener('focus', ()=>{ selectedIndex = idx; });
        resultsEl.appendChild(el);
      });
      // reset selection
      selectedIndex = -1;
    }

    function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function openUrl(url){
      // open in new tab
      window.open(url, '_blank');
    }

    function update(q){
      const qnorm = q.trim();
      if (!qnorm) {
        filtered = LINKS.slice().map(i=>({...i,_score:0}));
      } else {
        filtered = LINKS.map(i => ({...i, _score: computeScore(qnorm, i)}))
                        .filter(i => i._score > 0)
                        .sort((a,b)=>b._score - a._score);
      }
      renderList(filtered);
    }

    // focus management helpers
    function focusIndex(i){
      const nodes = Array.from(resultsEl.querySelectorAll('.item'));
      if (!nodes.length) return;
      if (i < 0) i = nodes.length - 1;
      if (i >= nodes.length) i = 0;
      nodes[i].focus();
      selectedIndex = i;
    }

    // initial render
    update('');

    // Ensure autofocus works reliably across browsers
    window.addEventListener('DOMContentLoaded', ()=>{
      // double-ensure focus
      try { input.focus({preventScroll:true}); input.select(); } catch(e) { input.focus(); }
    });

    // event handlers
    input.addEventListener('input', (e)=>{
      update(e.target.value);
    });

    input.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter'){
        e.preventDefault();
        // If a result is focused/selected, open that. Otherwise open first hit.
        if (selectedIndex >= 0 && filtered[selectedIndex]) {
          openUrl(filtered[selectedIndex].url);
        } else if (filtered.length) {
          openUrl(filtered[0].url);
        }
      } else if (e.key === 'ArrowDown'){
        e.preventDefault();
        focusIndex(0);
      } else if (e.key === 'Tab'){
        // move into list: focus first
        e.preventDefault();
        if (filtered.length) focusIndex(0);
      }
    });

    // allow global slash to focus the search
    document.addEventListener('keydown', (e)=>{
      if (e.key === '/' && document.activeElement !== input){ e.preventDefault(); input.focus(); input.select(); }
    });

    // make the whole component responsive to paste
    input.addEventListener('paste', ()=> setTimeout(()=> update(input.value), 50));

    // Accessibility: when focus returns to input, reset selectedIndex
    input.addEventListener('focus', ()=>{ selectedIndex = -1; });

    // ensure Enter on focused item opens it (for mouse/keyboard)
    resultsEl.addEventListener('keydown', (e)=>{
      const target = e.target.closest && e.target.closest('.item');
      if (!target) return;
      if (e.key === 'Enter') {
        e.preventDefault();
        const idx = Number(target.dataset.index);
        if (!Number.isNaN(idx) && filtered[idx]) openUrl(filtered[idx].url);
      }
    });

    // expose LINKS for easy customization in devtools
    window._LINKS = LINKS;

  </script>
</body>
</html>
